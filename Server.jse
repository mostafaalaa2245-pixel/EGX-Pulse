import express from "express";
import http from "http";
import { Server } from "socket.io";
import cors from "cors";

const app = express();
const server = http.createServer(app);
const io = new Server(server, {
  cors: { origin: "*" }
});

app.use(cors());

let stocks = [
  { symbol: "EGX30", price: 27000 },
  { symbol: "COMI", price: 57.2 },
  { symbol: "ETEL", price: 27.5 },
];

io.on("connection", (socket) => {
  console.log("Client connected âœ…");

  socket.emit("stocks", stocks);

  setInterval(() => {
    stocks = stocks.map(s => ({
      ...s,
      price: +(s.price + (Math.random() - 0.5)).toFixed(2)
    }));
    socket.emit("stocks", stocks);
  }, 3000);
});

app.get("/", (req, res) => {
  res.send("EGX Smart Tracker backend is running ğŸš€");
});

server.listen(4000, () => console.log("Server running on port 4000 ğŸ”¥"));
